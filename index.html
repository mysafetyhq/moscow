<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MoSCoW Bug Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --must: #e74c3c;
      --should: #e67e22;
      --could: #3498db;
      --wont: #95a5a6;
      --bg: #f4f4f4;
      --text: #2c3e50;
      --card-bg: #fff;
      --green: #2a502d;
      --green-light1: #3f6c44;
      --green-light2: #558e5c;
      --border-radius: 10px;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--bg);
      color: var(--text);
      padding: 2rem;
    }

    h1 {
      text-align: center;
    }

    form {
      max-width: 850px;
      margin: 0 auto 2rem auto;
      background: var(--card-bg);
      padding: 1rem 1.5rem;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
    }

    input, textarea, select, button {
      width: 100%;
      padding: 0.75rem;
      margin: 0.5rem 0;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
    }

    input:disabled, textarea:disabled, select:disabled {
      background: #eee;
      color: #666;
    }

    button {
      background-color: var(--text);
      color: white;
      border: none;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background-color: #1a252f;
    }

    .accordion h3 {
      cursor: pointer;
      background: #ecf0f1;
      padding: 0.75rem;
      border-radius: 6px;
      margin: 0;
    }

    .accordion-content {
      display: none;
      margin-top: 1rem;
      border-top: 1px solid #ccc;
      padding-top: 1rem;
    }

    .triage-flex {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .triage-item {
      flex: 1 1 calc(50% - 1rem);
      display: flex;
      align-items: center;
      background: var(--green-light1);
      color: white;
      padding: 0.5rem;
      border-radius: 6px;
    }

    .triage-item:nth-child(even) {
      background: var(--green-light2);
    }

    .triage-item input {
      margin-right: 0.5rem;
      width: auto;
    }

    .suggestion {
      background: #dfe6e9;
      padding: 0.75rem;
      border-left: 5px solid var(--text);
      margin: 1rem 0;
      border-radius: 6px;
    }

    .btn-row {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
    }

    .column {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 1rem;
    }

    .column h2 {
      margin-top: 0;
    }

    .must   { border-top: 5px solid var(--must);   }
    .should { border-top: 5px solid var(--should); }
    .could  { border-top: 5px solid var(--could);  }
    .wont   { border-top: 5px solid var(--wont);   }

    .bug-card {
      background: #fafafa;
      margin: 0.5rem 0;
      padding: 0.75rem;
      border-radius: 6px;
      border-left: 4px solid var(--text);
      cursor: pointer;
    }

    .bug-card:hover {
      background: #f0f0f0;
    }

    .bug-card h3 {
      margin: 0 0 0.25rem 0;
      font-size: 1rem;
    }

    .bug-card p {
      margin: 0;
      font-size: 0.9rem;
    }

    .bug-card small {
      display: block;
      margin-top: 0.25rem;
      font-size: 0.75rem;
      color: #555;
    }

    .charts {
      max-width: 900px;
      margin: 2rem auto;
    }

    #addNewBtn {
      display: none;
      margin: 1rem auto;
    }

    @media (max-width: 600px) {
      .triage-item {
        flex: 1 1 100%;
      }

      .container {
        grid-template-columns: 1fr;
      }

      .btn-row {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <h1>üõ†Ô∏è MoSCoW Bug Triage Tracker</h1>

  <form id="bugForm">
    <input type="text" id="title" placeholder="Bug Title" required />
    <textarea id="description" placeholder="Bug Description" rows="3" required></textarea>

    <div class="accordion">
      <h3 onclick="toggleAccordion()">+ Triage Details</h3>
      <div class="accordion-content" id="triageFields">
        <div class="triage-flex">
          <label class="triage-item">
            <input type="checkbox" id="affectsPayroll" /> Affects Payroll/W2/PTO?
          </label>
          <label class="triage-item">
            <input type="checkbox" id="dataLoss" /> Data loss, corruption, breach?
          </label>
          <label class="triage-item">
            <input type="checkbox" id="systemDown" /> System unavailable?
          </label>
          <label class="triage-item">
            <input type="checkbox" id="isBlockingTeam" /> Blocking implementation team?
          </label>
          <label class="triage-item">
            <input type="checkbox" id="financialImpact" /> Financial impact?
          </label>
          <label class="triage-item">
            <input type="checkbox" id="primaryFunction" /> Primary function affected?
          </label>
          <label class="triage-item">
            <input type="checkbox" id="workaroundExists" /> Workaround exists?
          </label>
          <label class="triage-item">
            <input type="checkbox" id="performanceDegraded" /> Performance degraded?
          </label>
        </div>

        <label>Bug or Improvement?
          <select id="isBug">
            <option value="bug">Bug</option>
            <option value="improvement">Improvement</option>
          </select>
        </label>
        <label>Customer Count Affected:
          <select id="customerCount">
            <option value="none">None</option>
            <option value="few">Few</option>
            <option value="many">Many</option>
            <option value="all">All</option>
          </select>
        </label>
      </div>
    </div>

    <div class="suggestion">
      Suggested Triage Level: <strong id="triageLevel">-</strong> |
      Suggested MoSCoW Priority: <strong id="suggestedPriority">-</strong>
    </div>

    <select id="priority" required>
      <option value="">Select MoSCoW Priority</option>
      <option value="must">Must</option>
      <option value="should">Should</option>
      <option value="could">Could</option>
      <option value="wont">Won't</option>
    </select>

    <button type="submit">Add Bug</button>
    <button id="addNewBtn" type="button" onclick="clearForm()">üîÑ Add New</button>
  </form>

  <div class="btn-row">
    <button onclick="saveBugs()">üíæ Save State</button>
    <button onclick="loadBugs()">üìÇ Load State</button>
  </div>

  <div class="charts">
    <canvas id="moscowChart"></canvas>
    <br/>
    <canvas id="triageChart"></canvas>
  </div>

  <div class="container">
    <div class="column must">
      <h2>Must Have</h2>
      <div id="mustList"></div>
    </div>
    <div class="column should">
      <h2>Should Have</h2>
      <div id="shouldList"></div>
    </div>
    <div class="column could">
      <h2>Could Have</h2>
      <div id="couldList"></div>
    </div>
    <div class="column wont">
      <h2>Won't Have</h2>
      <div id="wontList"></div>
    </div>
  </div>
<script>
  const form = document.getElementById("bugForm");
  const prioritySelect = document.getElementById("priority");
  const triageLevelText = document.getElementById("triageLevel");
  const suggestedPriorityText = document.getElementById("suggestedPriority");
  const accordionContent = document.getElementById("triageFields");
  const addNewBtn = document.getElementById("addNewBtn");

  const lists = {
    must: document.getElementById("mustList"),
    should: document.getElementById("shouldList"),
    could: document.getElementById("couldList"),
    wont: document.getElementById("wontList"),
  };

  let bugs = [];
  let isReadOnly = false;
  let moscowChart, triageChart;

  function toggleAccordion() {
    accordionContent.style.display = accordionContent.style.display === "block" ? "none" : "block";
  }

  function calculateTriageLevel() {
    const triage = {
      affectsPayroll: document.getElementById("affectsPayroll").checked,
      dataLoss: document.getElementById("dataLoss").checked,
      systemDown: document.getElementById("systemDown").checked,
      isBlockingTeam: document.getElementById("isBlockingTeam").checked,
      financialImpact: document.getElementById("financialImpact").checked,
      primaryFunction: document.getElementById("primaryFunction").checked,
      workaroundExists: document.getElementById("workaroundExists").checked,
      performanceDegraded: document.getElementById("performanceDegraded").checked,
    };

    let score = 4;
    if (triage.affectsPayroll || triage.dataLoss || triage.systemDown || triage.isBlockingTeam || triage.financialImpact) {
      score = 1;
    } else if ((triage.primaryFunction && !triage.workaroundExists) || (triage.performanceDegraded && triage.primaryFunction)) {
      score = 2;
    } else if ((!triage.primaryFunction && !triage.workaroundExists) || (triage.performanceDegraded && !triage.primaryFunction)) {
      score = 3;
    }

    const severityMap = { 1: "Critical", 2: "High", 3: "Medium", 4: "Low" };
    const moscowMap = { 1: "Must", 2: "Should", 3: "Could", 4: "Won't" };

    triageLevelText.textContent = severityMap[score];
    suggestedPriorityText.textContent = moscowMap[score];
    return { severity: severityMap[score], suggested: moscowMap[score] };
  }

  form.addEventListener("input", () => {
    if (!isReadOnly) calculateTriageLevel();
  });

  window.addEventListener("load", () => {
    loadBugs();
    calculateTriageLevel();
  });

  form.addEventListener("submit", function (e) {
    e.preventDefault();
    if (isReadOnly) return;

    const title = document.getElementById("title").value.trim();
    const description = document.getElementById("description").value.trim();
    const priority = prioritySelect.value;
    const triage = calculateTriageLevel();

    if (!title || !description || !priority) return;

    const timestamp = new Date().toLocaleString();

    const newBug = {
      title,
      description,
      priority,
      triageLevel: triage.severity,
      suggestedPriority: triage.suggested,
      timestamp,
    };

    bugs.push(newBug);
    renderBugs();
    saveBugs();
    form.reset();
    calculateTriageLevel();
  });

  function renderBugs() {
    for (const key in lists) lists[key].innerHTML = "";

    const moscowCounts = { must: 0, should: 0, could: 0, wont: 0 };
    const triageCounts = { Critical: 0, High: 0, Medium: 0, Low: 0 };

    bugs.forEach((bug, index) => {
      const card = document.createElement("div");
      card.className = "bug-card";
      card.innerHTML = `<h3>${bug.title}</h3>
        <p>${bug.description}</p>
        <small><strong>Triage:</strong> ${bug.triageLevel} | <strong>MoSCoW:</strong> ${bug.suggestedPriority}</small>
        <small><em>${bug.timestamp}</em></small>`;
      card.onclick = () => loadBugIntoForm(index);
      lists[bug.priority].appendChild(card);

      moscowCounts[bug.priority]++;
      triageCounts[bug.triageLevel]++;
    });

    updateCharts(moscowCounts, triageCounts);
  }

  function loadBugIntoForm(index) {
    const bug = bugs[index];
    isReadOnly = true;
    addNewBtn.style.display = "block";

    document.getElementById("title").value = bug.title;
    document.getElementById("description").value = bug.description;
    prioritySelect.value = bug.priority;

    document.querySelectorAll("input, textarea, select").forEach(el => {
      el.disabled = true;
    });

    triageLevelText.textContent = bug.triageLevel;
    suggestedPriorityText.textContent = bug.suggestedPriority;
  }

  function clearForm() {
    isReadOnly = false;
    addNewBtn.style.display = "none";
    form.reset();
    document.querySelectorAll("input, textarea, select").forEach(el => el.disabled = false);
    calculateTriageLevel();
  }

  function saveBugs() {
    localStorage.setItem("moscow_bugs", JSON.stringify(bugs));
    alert("‚úÖ State saved!");
  }

  function loadBugs() {
    const stored = localStorage.getItem("moscow_bugs");
    if (stored) {
      bugs = JSON.parse(stored);
      renderBugs();
    }
  }

  function updateCharts(moscowCounts, triageCounts) {
    const ctx1 = document.getElementById("moscowChart").getContext("2d");
    const ctx2 = document.getElementById("triageChart").getContext("2d");

    const moscowData = {
      labels: ["Must", "Should", "Could", "Won't"],
      datasets: [{
        label: "MoSCoW Distribution",
        data: [
          moscowCounts.must,
          moscowCounts.should,
          moscowCounts.could,
          moscowCounts.wont
        ],
        backgroundColor: ["#e74c3c", "#e67e22", "#3498db", "#95a5a6"]
      }]
    };

    const triageData = {
      labels: ["Critical", "High", "Medium", "Low"],
      datasets: [{
        label: "Triage Severity",
        data: [
          triageCounts.Critical,
          triageCounts.High,
          triageCounts.Medium,
          triageCounts.Low
        ],
        backgroundColor: ["#c0392b", "#d35400", "#2980b9", "#7f8c8d"]
      }]
    };

    if (moscowChart) moscowChart.destroy();
    if (triageChart) triageChart.destroy();

    moscowChart = new Chart(ctx1, {
      type: "bar",
      data: moscowData,
      options: {
        responsive: true,
        plugins: { legend: { display: false } }
      }
    });

    triageChart = new Chart(ctx2, {
      type: "doughnut",
      data: triageData,
      options: {
        responsive: true,
        plugins: { legend: { position: "bottom" } }
      }
    });
  }
</script>
</body>
</html>
