<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MoSCoW Bug Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
:root {
  --main-green: #2a502d;
  --accent-yellow: #f3bf34;
  --bg: var(--main-green);
  --text: #e6e6e6;
  --card-bg: #3c6e47;
  --card-hover: #4d8e5c;
  --primary-hue: var(--main-green);
  --must-color: #d4af37;   /* goldish (uses accent yellow) */
  --should-color: #9ccf6f; /* light green */
  --could-color: #c7d8a7;  /* pale green */
  --wont-color: #7a8a6f;   /* muted olive */
}

body {
  margin: 0;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background-color: var(--bg);
  color: var(--text);
  padding: 2rem;
  min-height: 100vh;
}

h1, h2, h3 {
  font-weight: 700;
  color: var(--accent-yellow);
  margin-bottom: 0.5rem;
}

input, textarea, select, button {
  font-family: inherit;
  font-size: 1rem;
  padding: 0.5rem;
  margin: 0.25rem 0;
  border-radius: 6px;
  border: none;
  outline: none;
  box-sizing: border-box;
}

input, textarea, select {
  background: #486a3e;
  color: var(--text);
  border: 1px solid #3b5930;
  transition: background-color 0.3s ease;
}

input:focus, textarea:focus, select:focus {
  background: #5d7c4c;
  border-color: var(--accent-yellow);
  color: #fff;
}

button {
  background-color: var(--accent-yellow);
  color: var(--main-green);
  font-weight: 600;
  cursor: pointer;
  border: 2px solid transparent;
  transition: background-color 0.3s ease, border-color 0.3s ease;
}

button:hover {
  background-color: #e6ac22;
  border-color: var(--accent-yellow);
}

.accordion h3 {
  background-color: #37522d;
  padding: 0.6rem 1rem;
  border-radius: 6px;
  color: var(--accent-yellow);
  cursor: pointer;
  user-select: none;
  margin-bottom: 0;
}

.accordion-content {
  background-color: #3f6b3a;
  padding: 1rem;
  border-radius: 0 0 6px 6px;
  display: none;
  margin-bottom: 1rem;
  color: var(--text);
}

.triage-flex {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
}

.triage-item {
  flex: 1 1 200px;
  display: flex;
  align-items: center;
  gap: 8px;
  background-color: var(--card-bg);
  border-radius: 6px;
  padding: 0.4rem 0.8rem;
  user-select: none;
  color: var(--text);
  transition: background-color 0.3s ease;
}

.triage-item:nth-child(odd) {
  background-color: #466f38; /* slightly lighter */
}

.bug-card {
  background-color: var(--card-bg);
  border-radius: 8px;
  padding: 1rem;
  margin-bottom: 1rem;
  cursor: pointer;
  transition: background-color 0.25s ease;
  box-shadow: 0 3px 6px rgba(0,0,0,0.3);
  color: var(--text);
}

.bug-card:hover {
  background-color: var(--card-hover);
}

.container {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
  margin-top: 1.5rem;
}

.column {
  flex: 1 1 220px;
  background-color: var(--card-bg);
  border-radius: 8px;
  padding: 1rem;
  max-height: 75vh;
  overflow-y: auto;
  box-shadow: 0 3px 6px rgba(0,0,0,0.3);
}

.must { border-top: 4px solid var(--must-color); }
.should { border-top: 4px solid var(--should-color); }
.could { border-top: 4px solid var(--could-color); }
.wont { border-top: 4px solid var(--wont-color); }

.suggestion {
  margin: 1rem 0;
  font-size: 1.1rem;
  color: var(--accent-yellow);
  font-weight: 700;
}

.btn-row {
  margin-top: 1rem;
  margin-bottom: 1rem;
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
  justify-content: flex-start;
}

.charts {
  max-width: 900px;
  margin-top: 2rem;
  margin-bottom: 2rem;
}

/* Scrollbar styling for better UX */
.column::-webkit-scrollbar {
  width: 8px;
}

.column::-webkit-scrollbar-thumb {
  background-color: var(--accent-yellow);
  border-radius: 10px;
}

.column::-webkit-scrollbar-track {
  background-color: #3d6a39;
}

  </style>
</head>
<body>
  <h1>üõ†Ô∏è MoSCoW Bug Triage Tracker</h1>

  <form id="bugForm">
    <input type="text" id="title" placeholder="Bug Title" required />
    <textarea id="description" placeholder="Bug Description" rows="3" required></textarea>

    <div class="accordion">
      <h3 onclick="toggleAccordion()">+ Triage Details</h3>
      <div class="accordion-content" id="triageFields">
        <div class="triage-flex">
          <label class="triage-item">
            <input type="checkbox" id="affectsPayroll" /> Affects Payroll/W2/PTO?
          </label>
          <label class="triage-item">
            <input type="checkbox" id="dataLoss" /> Data loss, corruption, breach?
          </label>
          <label class="triage-item">
            <input type="checkbox" id="systemDown" /> System unavailable?
          </label>
          <label class="triage-item">
            <input type="checkbox" id="isBlockingTeam" /> Blocking implementation team?
          </label>
          <label class="triage-item">
            <input type="checkbox" id="financialImpact" /> Financial impact?
          </label>
          <label class="triage-item">
            <input type="checkbox" id="primaryFunction" /> Primary function affected?
          </label>
          <label class="triage-item">
            <input type="checkbox" id="workaroundExists" /> Workaround exists?
          </label>
          <label class="triage-item">
            <input type="checkbox" id="performanceDegraded" /> Performance degraded?
          </label>
        </div>

        <label>Bug or Improvement?
          <select id="isBug">
            <option value="bug">Bug</option>
            <option value="improvement">Improvement</option>
          </select>
        </label>
        <label>Customer Count Affected:
          <select id="customerCount">
            <option value="none">None</option>
            <option value="few">Few</option>
            <option value="many">Many</option>
            <option value="all">All</option>
          </select>
        </label>
      </div>
    </div>

    <div class="suggestion">
      Suggested Triage Level: <strong id="triageLevel">-</strong> |
      Suggested MoSCoW Priority: <strong id="suggestedPriority">-</strong>
    </div>

    <select id="priority" required>
      <option value="">Select MoSCoW Priority</option>
      <option value="must">Must</option>
      <option value="should">Should</option>
      <option value="could">Could</option>
      <option value="wont">Won't</option>
    </select>

    <button type="submit">Add Bug</button>
    <button id="addNewBtn" type="button" onclick="clearForm()">üîÑ Add New</button>
  </form>

  <div class="btn-row">
    <button onclick="saveBugs()">üíæ Save State</button>
    <button onclick="loadBugs()">üìÇ Load State</button>
  </div>

  <div class="charts">
    <canvas id="moscowChart"></canvas>
    <br/>
    <canvas id="triageChart"></canvas>
  </div>

  <div class="container">
    <div class="column must">
      <h2>Must Have</h2>
      <div id="mustList"></div>
    </div>
    <div class="column should">
      <h2>Should Have</h2>
      <div id="shouldList"></div>
    </div>
    <div class="column could">
      <h2>Could Have</h2>
      <div id="couldList"></div>
    </div>
    <div class="column wont">
      <h2>Won't Have</h2>
      <div id="wontList"></div>
    </div>
  </div>
<script>
  const form = document.getElementById("bugForm");
  const prioritySelect = document.getElementById("priority");
  const triageLevelText = document.getElementById("triageLevel");
  const suggestedPriorityText = document.getElementById("suggestedPriority");
  const accordionContent = document.getElementById("triageFields");
  const addNewBtn = document.getElementById("addNewBtn");

  const lists = {
    must: document.getElementById("mustList"),
    should: document.getElementById("shouldList"),
    could: document.getElementById("couldList"),
    wont: document.getElementById("wontList"),
  };

  let bugs = [];
  let isReadOnly = false;
  let moscowChart, triageChart;

  function toggleAccordion() {
    accordionContent.style.display = accordionContent.style.display === "block" ? "none" : "block";
  }

  function calculateTriageLevel() {
    const triage = {
      affectsPayroll: document.getElementById("affectsPayroll").checked,
      dataLoss: document.getElementById("dataLoss").checked,
      systemDown: document.getElementById("systemDown").checked,
      isBlockingTeam: document.getElementById("isBlockingTeam").checked,
      financialImpact: document.getElementById("financialImpact").checked,
      primaryFunction: document.getElementById("primaryFunction").checked,
      workaroundExists: document.getElementById("workaroundExists").checked,
      performanceDegraded: document.getElementById("performanceDegraded").checked,
    };

    let score = 4;
    if (triage.affectsPayroll || triage.dataLoss || triage.systemDown || triage.isBlockingTeam || triage.financialImpact) {
      score = 1;
    } else if ((triage.primaryFunction && !triage.workaroundExists) || (triage.performanceDegraded && triage.primaryFunction)) {
      score = 2;
    } else if ((!triage.primaryFunction && !triage.workaroundExists) || (triage.performanceDegraded && !triage.primaryFunction)) {
      score = 3;
    }

    const severityMap = { 1: "Critical", 2: "High", 3: "Medium", 4: "Low" };
    const moscowMap = { 1: "Must", 2: "Should", 3: "Could", 4: "Won't" };

    triageLevelText.textContent = severityMap[score];
    suggestedPriorityText.textContent = moscowMap[score];
    return { severity: severityMap[score], suggested: moscowMap[score] };
  }

  form.addEventListener("input", () => {
    if (!isReadOnly) calculateTriageLevel();
  });

  window.addEventListener("load", () => {
    loadBugs();
    calculateTriageLevel();
  });

  form.addEventListener("submit", function (e) {
    e.preventDefault();
    if (isReadOnly) return;

    const title = document.getElementById("title").value.trim();
    const description = document.getElementById("description").value.trim();
    const priority = prioritySelect.value;
    const triage = calculateTriageLevel();

    if (!title || !description || !priority) return;

    const timestamp = new Date().toLocaleString();

    const newBug = {
      title,
      description,
      priority,
      triageLevel: triage.severity,
      suggestedPriority: triage.suggested,
      timestamp,
    };

    bugs.push(newBug);
    renderBugs();
    saveBugs();
    form.reset();
    calculateTriageLevel();
  });

  function renderBugs() {
    for (const key in lists) lists[key].innerHTML = "";

    const moscowCounts = { must: 0, should: 0, could: 0, wont: 0 };
    const triageCounts = { Critical: 0, High: 0, Medium: 0, Low: 0 };

    bugs.forEach((bug, index) => {
      const card = document.createElement("div");
      card.className = "bug-card";
      card.innerHTML = `<h3>${bug.title}</h3>
        <p>${bug.description}</p>
        <small><strong>Triage:</strong> ${bug.triageLevel} | <strong>MoSCoW:</strong> ${bug.suggestedPriority}</small>
        <small><em>${bug.timestamp}</em></small>`;
      card.onclick = () => loadBugIntoForm(index);
      lists[bug.priority].appendChild(card);

      moscowCounts[bug.priority]++;
      triageCounts[bug.triageLevel]++;
    });

    updateCharts(moscowCounts, triageCounts);
  }

  function loadBugIntoForm(index) {
    const bug = bugs[index];
    isReadOnly = true;
    addNewBtn.style.display = "block";

    document.getElementById("title").value = bug.title;
    document.getElementById("description").value = bug.description;
    prioritySelect.value = bug.priority;

    document.querySelectorAll("input, textarea, select").forEach(el => {
      el.disabled = true;
    });

    triageLevelText.textContent = bug.triageLevel;
    suggestedPriorityText.textContent = bug.suggestedPriority;
  }

  function clearForm() {
    isReadOnly = false;
    addNewBtn.style.display = "none";
    form.reset();
    document.querySelectorAll("input, textarea, select").forEach(el => el.disabled = false);
    calculateTriageLevel();
  }

  function saveBugs() {
    localStorage.setItem("moscow_bugs", JSON.stringify(bugs));
    alert("‚úÖ State saved!");
  }

  function loadBugs() {
    const stored = localStorage.getItem("moscow_bugs");
    if (stored) {
      bugs = JSON.parse(stored);
      renderBugs();
    }
  }

  function updateCharts(moscowCounts, triageCounts) {
    const ctx1 = document.getElementById("moscowChart").getContext("2d");
    const ctx2 = document.getElementById("triageChart").getContext("2d");

    const moscowData = {
      labels: ["Must", "Should", "Could", "Won't"],
      datasets: [{
        label: "MoSCoW Distribution",
        data: [
          moscowCounts.must,
          moscowCounts.should,
          moscowCounts.could,
          moscowCounts.wont
        ],
        backgroundColor: ["#e74c3c", "#e67e22", "#3498db", "#95a5a6"]
      }]
    };

    const triageData = {
      labels: ["Critical", "High", "Medium", "Low"],
      datasets: [{
        label: "Triage Severity",
        data: [
          triageCounts.Critical,
          triageCounts.High,
          triageCounts.Medium,
          triageCounts.Low
        ],
        backgroundColor: ["#c0392b", "#d35400", "#2980b9", "#7f8c8d"]
      }]
    };

    if (moscowChart) moscowChart.destroy();
    if (triageChart) triageChart.destroy();

    moscowChart = new Chart(ctx1, {
      type: "bar",
      data: moscowData,
      options: {
        responsive: true,
        plugins: { legend: { display: false } }
      }
    });

    triageChart = new Chart(ctx2, {
      type: "doughnut",
      data: triageData,
      options: {
        responsive: true,
        plugins: { legend: { position: "bottom" } }
      }
    });
  }
</script>
</body>
</html>
